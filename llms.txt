# tidytacos

[![R-CMD-check](https://github.com/LebeerLab/tidytacos/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/LebeerLab/tidytacos/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/gh/LebeerLab/tidytacos/graph/badge.svg?token=532YS16DXU)](https://codecov.io/gh/LebeerLab/tidytacos)  
  
  
  
  

## Overview

Tidytacos (tidy TAxonomic COmpositionS) is an R package for the
exploration of microbial community data. Such community data consists of
read counts generated by amplicon sequencing (e.g. a region of the 16S
rRNA gene) or metagenome (shotgun) sequencing. Each read count
represents a number of sequencing reads identified for some taxon (an
ASV, OTU, species, or higher-level taxon) in a sample.

Tidytacos builds on the [tidyverse](https://www.tidyverse.org/) created
by [Hadley Wickham](http://hadley.nz/): the data are stored in tidy
tables where each row is an observation and each column a variable. In
addition, the package supplies a set of “verbs”: functions that take a
tidytacos object as first argument and also return a tidytacos object.
This makes it easy to construct “pipe chains” of code that represent
series of operations performed on the tidytacos object.

## Prerequisites

Tidytacos is an R package. You can find instructions to download and
install R [here](https://cran.r-project.org/).

Tidytacos relies on the tidyverse R package (or, more accurately, set of
R packages). You can install the tidyverse by running the following R
code:

``` r
install.packages("tidyverse")
```

Finally, RStudio is a nice IDE to work with R code (as well as code in
other scripting languages). It has a lot more features than what the
default R IDE allows: beyond creating and saving scripts, it also shows
your figures, allows you to navigate files, allows you to inspect tables
etc. You can download RStudio [here](https://posit.co/downloads/).

## Installation

Run the following R code to install the latest version of tidytacos:

``` r
install.packages("devtools")
devtools::install_github("LebeerLab/tidytacos")
```

## Getting started

If your ASVs are counted and annotated using
[dada2](https://benjjneb.github.io/dada2/), you can use the following
function to convert the results to a tidytacos object:

``` r
seqtab <- readRDS(system.file("extdata", "dada2", "seqtab.rds", package = "tidytacos"))
taxa <- readRDS(system.file("extdata", "dada2", "taxa.rds", package = "tidytacos"))

taco <- from_dada(seqtab, taxa)
```

Where seqtab and taxa refer to the R objects [as calculated in the dada2
tutorial](https://benjjneb.github.io/dada2/tutorial.html) and available
in the extdata of this package.

If you have data in the form of a phyloseq object you could convert it
using:

``` r
phylo_obj <- readRDS(system.file("extdata","phyloseq.rds",package='tidytacos'))
taco <- from_phyloseq(phylo_obj)
```

You may wish to create a tidytacos object from your counts matrix, for
example an OTU table where rownames are samples and colnames are taxa.
After that is done, you can add your taxonomy table and sample data. The
variable ‘taxon’ of the taxonomy table should align with the rownames of
the OTU table. Furthermore it may include all taxonomic levels from
‘kingdom’ or ‘domain’ to ‘species’ and a ‘sequence’ variable (nucleotide
sequence). The variable ‘sample’ of the sample data should align with
the rownames of the OTU table.

``` r
seqtab <- readRDS(system.file("extdata", "dada2", "seqtab.rds", package = "tidytacos"))
taxa <- readRDS(system.file("extdata", "dada2", "taxa.rds", package = "tidytacos"))
taxon <- rownames(taxa)
taxa <- cbind(taxon, as_tibble(taxa))

taco <- create_tidytacos(seqtab, taxa_are_columns = TRUE)
taco <- taco%>%
  add_metadata(taxa, table_type="taxa")
```

A tidytacos object is read and stored as three sparse tables (counts-,
taxa- and samples.csv). To read in existing data from a folder, [for
example one called ‘leaf’ in the ‘data-raw/tidytacos’
folder](https://github.com/LebeerLab/tidytacos/tree/dev/data-raw/tidytacos/leaf)
you would run:

``` r
my_path <- system.file("extdata", "tidytacos", "leaf", package = "tidytacos")
taco <- read_tidytacos(my_path)
```

To read your own tidytacos data replace the path with a local path.

## Documentation

[A documentation page (help
page)](https://lebeerlab.github.io/tidytacos/reference/index.html) is
available for all functions in the browser or in R. You can view it in R
by running
e.g. [`?filter_samples`](https://lebeerlab.github.io/tidytacos/reference/filter_samples.md).
Some useful tutorials can be found in the documentation [Articles
page](https://lebeerlab.github.io/tidytacos/articles/index.html) and on
the [wiki](https://github.com/LebeerLab/tidytacos/wiki).

## Need support?

Post on [GitHub issues](https://github.com/LebeerLab/tidytacos/issues)
if you have questions, requests, or if you run into an issue.

## Feel like contributing?

Please read the [GitHub Developer
Guide](https://github.com/LebeerLab/tidytacos/wiki/Developer-Guide).
Fork the dev branch, make your changes and make a pull request. Your
suggestions will be reviewed and if approved, will be implemented in the
next release.

## Citation

If you’ve found tidytacos useful in your own work, please cite the
following manuscript:

``` R
  Wittouck et al., (2025). Tidytacos: An R package for analyses on taxonomic composition of microbial communities. Journal of Open Source Software, 10(105), 6313, https://doi.org/10.21105/joss.06313
```

# Package index

## Tidytacos

Package overview

- [`tidytacos-package`](https://lebeerlab.github.io/tidytacos/reference/tidytacos-package.md)
  : tidytacos: Manipulate Taxonomic Composition Data of Microbial
  Communities
- [`tidytacos`](https://lebeerlab.github.io/tidytacos/reference/tidytacos.md)
  : tidytacos: Functions to manipulate and visualize amplicon count
  data.

## File handling

Functions for loading in or creating tidytaco objects or converting to
another datatype.

- [`read_tidytacos()`](https://lebeerlab.github.io/tidytacos/reference/read_tidytacos.md)
  : Read community data written by tidytacos
- [`write_tidytacos()`](https://lebeerlab.github.io/tidytacos/reference/write_tidytacos.md)
  : Write community data in tidytacos format
- [`merge_tidytacos()`](https://lebeerlab.github.io/tidytacos/reference/merge_tidytacos.md)
  : Merge two tidytacos objects
- [`create_tidytacos()`](https://lebeerlab.github.io/tidytacos/reference/create_tidytacos.md)
  : Initiate tidytacos object
- [`add_metadata()`](https://lebeerlab.github.io/tidytacos/reference/add_metadata.md)
  : Add metadata to the tidytacos object
- [`from_dada()`](https://lebeerlab.github.io/tidytacos/reference/from_dada.md)
  : DADA2 to a tidytacos object
- [`from_phyloseq()`](https://lebeerlab.github.io/tidytacos/reference/from_phyloseq.md)
  : Convert phyloseq object to tidytacos object
- [`as_phyloseq()`](https://lebeerlab.github.io/tidytacos/reference/as_phyloseq.md)
  : Convert tidytacos object to phyloseq object
- [`to_biom()`](https://lebeerlab.github.io/tidytacos/reference/to_biom.md)
  : Write the counts of the tidytacos object to a biom file
- [`to_fasta()`](https://lebeerlab.github.io/tidytacos/reference/to_fasta.md)
  : Write the sequences of the taxa table to a fasta file

## Table manipulation

Functions for manipulation of the three distinct tables using
tidy-related functions.

- [`samples()`](https://lebeerlab.github.io/tidytacos/reference/samples.md)
  : Extract the sample table
- [`taxa()`](https://lebeerlab.github.io/tidytacos/reference/taxa.md) :
  Extract the taxon table
- [`counts()`](https://lebeerlab.github.io/tidytacos/reference/counts.md)
  : Extract the count table
- [`select_counts()`](https://lebeerlab.github.io/tidytacos/reference/select_counts.md)
  : Retain or remove a set of count variables
- [`select_samples()`](https://lebeerlab.github.io/tidytacos/reference/select_samples.md)
  : Retain or remove a set of sample variables
- [`select_taxa()`](https://lebeerlab.github.io/tidytacos/reference/select_taxa.md)
  : Retain or remove a set of taxon variables
- [`mutate_counts()`](https://lebeerlab.github.io/tidytacos/reference/mutate_counts.md)
  : Create extra variables in the count table
- [`mutate_samples()`](https://lebeerlab.github.io/tidytacos/reference/mutate_samples.md)
  : Create extra variables in the sample table
- [`mutate_taxa()`](https://lebeerlab.github.io/tidytacos/reference/mutate_taxa.md)
  : Create extra variables in the taxa table
- [`filter_counts()`](https://lebeerlab.github.io/tidytacos/reference/filter_counts.md)
  : Filter the counts
- [`filter_samples()`](https://lebeerlab.github.io/tidytacos/reference/filter_samples.md)
  : Filter the samples
- [`filter_taxa()`](https://lebeerlab.github.io/tidytacos/reference/filter_taxa.md)
  : Filter the taxa
- [`aggregate_samples()`](https://lebeerlab.github.io/tidytacos/reference/aggregate_samples.md)
  : Aggregate samples with identical values for all metadata
- [`aggregate_taxa()`](https://lebeerlab.github.io/tidytacos/reference/aggregate_taxa.md)
  : Aggregate taxa on a given taxonomic rank
- [`everything()`](https://lebeerlab.github.io/tidytacos/reference/everything.md)
  : Get all data in one single table
- [`group_samples()`](https://lebeerlab.github.io/tidytacos/reference/group_samples.md)
  : Group the samples
- [`grouped_taco`](https://lebeerlab.github.io/tidytacos/reference/grouped_taco.md)
  : An S4 class to store a grouped tidytaco with group_samples

## Relative abundance, prevalence and other count computations

Functions for transforming the count table to different matrix
representations or pairwise comparison.

- [`counts_matrix()`](https://lebeerlab.github.io/tidytacos/reference/counts_matrix.md)
  : Return a counts matrix
- [`rel_abundance_matrix()`](https://lebeerlab.github.io/tidytacos/reference/rel_abundance_matrix.md)
  : Return a relative abundance matrix
- [`add_rel_abundance()`](https://lebeerlab.github.io/tidytacos/reference/add_rel_abundance.md)
  : Add relative abundances to count table
- [`add_mean_rel_abundance()`](https://lebeerlab.github.io/tidytacos/reference/add_mean_rel_abundance.md)
  : Add average relative abundances to taxa table
- [`mean_rel_abundances()`](https://lebeerlab.github.io/tidytacos/reference/mean_rel_abundances.md)
  : Get mean relative abundances of taxa in general or per condition
- [`add_absolute_abundance()`](https://lebeerlab.github.io/tidytacos/reference/add_absolute_abundance.md)
  : Add absolute abundances to count table
- [`add_spike_ratio()`](https://lebeerlab.github.io/tidytacos/reference/add_spike_ratio.md)
  : Add spike ratio
- [`add_density()`](https://lebeerlab.github.io/tidytacos/reference/add_density.md)
  : Add density to count table
- [`add_logratio()`](https://lebeerlab.github.io/tidytacos/reference/add_logratio.md)
  : Add logratios
- [`add_clr_abundance()`](https://lebeerlab.github.io/tidytacos/reference/add_clr_abundance.md)
  : Perform a centered log ratio transformation on the readcounts.
- [`add_jervis_bardy()`](https://lebeerlab.github.io/tidytacos/reference/add_jervis_bardy.md)
  : Apply the taxon QC method of Jervis-Bardy
- [`prevalences()`](https://lebeerlab.github.io/tidytacos/reference/prevalences.md)
  : Get prevalences of taxa in general or per condition
- [`add_prevalence()`](https://lebeerlab.github.io/tidytacos/reference/add_prevalence.md)
  : Add taxon prevalences to the taxon table
- [`counts_tidy()`](https://lebeerlab.github.io/tidytacos/reference/counts_tidy.md)
  : Convert matrix with counts to tidy data frame
- [`add_total_absolute_abundance()`](https://lebeerlab.github.io/tidytacos/reference/add_total_absolute_abundance.md)
  : Add total absolute abundances of samples
- [`add_total_count()`](https://lebeerlab.github.io/tidytacos/reference/add_total_count.md)
  : Add total read count per sample
- [`add_total_density()`](https://lebeerlab.github.io/tidytacos/reference/add_total_density.md)
  : Add total densities of samples
- [`add_dominant_taxa()`](https://lebeerlab.github.io/tidytacos/reference/add_dominant_taxa.md)
  : Adds the most dominant taxa in the sample to the sample table

## Plotting

Functions for various plots that can be made with the data in a
tidytacos object.

- [`tacoplot_alphas()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_alphas.md)
  : Return a boxplot of every alpha metric per group in the samples
  table of a tidytaco object. If no alpha metrics are present, all
  available ones are added.
- [`tacoplot_codifab()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_codifab.md)
  : Generate a compositional differential abundance plot
- [`tacoplot_euler()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_euler.md)
  : Return an euler diagram of overlapping taxon_ids between conditions
- [`tacoplot_ord()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_ord.md)
  : Return an ordination plot of the samples
- [`tacoplot_ord_ly()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_ord_ly.md)
  : Return an interactive ordination plot of the samples
- [`tacoplot_prevalences()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_prevalences.md)
  : Return a heatmap of prevalence of taxa in groups of samples
- [`tacoplot_scree()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_scree.md)
  : Return a scree plot to visualize the eigenvalues of the PCA.
- [`tacoplot_stack()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_stack.md)
  : Return a bar plot of the samples
- [`tacoplot_stack_ly()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_stack_ly.md)
  : Return an interactive bar plot of the samples
- [`tacoplot_venn()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_venn.md)
  : Return a venn diagram of overlapping taxon_ids between conditions
- [`tacoplot_venn_ly()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_venn_ly.md)
  : Return an interactive venn diagram of overlapping taxon_ids between
  conditions
- [`tacoplot_zoom()`](https://lebeerlab.github.io/tidytacos/reference/tacoplot_zoom.md)
  : Return a visualization designed for a small number of samples

## Statistical tests

Functions for various statistical tests that can be performed on a
tidytacos object.

- [`perform_adonis()`](https://lebeerlab.github.io/tidytacos/reference/perform_adonis.md)
  : Perform an adonis test
- [`perform_anosim()`](https://lebeerlab.github.io/tidytacos/reference/perform_anosim.md)
  : Perform anosim test
- [`perform_lda()`](https://lebeerlab.github.io/tidytacos/reference/perform_lda.md)
  : LDA model estimation
- [`perform_mantel_test()`](https://lebeerlab.github.io/tidytacos/reference/perform_mantel_test.md)
  : Determine the correlation between the distance of the counts in a
  tidytacos object and a sample variable, multiple sample variables or
  another matrix.
- [`add_codifab()`](https://lebeerlab.github.io/tidytacos/reference/add_codifab.md)
  : Perform compositional differential abundance analysis

## Taxonomy related functions

Functions to manipulate taxonomy names.

- [`rank_names()`](https://lebeerlab.github.io/tidytacos/reference/rank_names.md)
  : Return rank names associated with a tidytacos object if these are
  defined. In case of undefined rank names, the function returns the
  taxon_id field.

- [`set_rank_names()`](https://lebeerlab.github.io/tidytacos/reference/set_rank_names.md)
  : Set rank names for a tidytacos object

- [`add_taxon_name()`](https://lebeerlab.github.io/tidytacos/reference/add_taxon_name.md)
  : Add sensible taxon name to taxon table

- [`add_taxon_name_color()`](https://lebeerlab.github.io/tidytacos/reference/add_taxon_name_color.md)
  : Add taxon color for visualization.

- [`add_eigentaxa()`](https://lebeerlab.github.io/tidytacos/reference/add_eigentaxa.md)
  :

  Calculates eigentaxa values based on SparCC - MCL generated clusters
  per sample. It is advised to run
  [`cluster_taxa()`](https://lebeerlab.github.io/tidytacos/reference/cluster_taxa.md)
  on the tidytacos object before running this function to add the
  clusters if you want to stray from any default parameters.

## Diversity analysis

Functions to add various diversity metrics to the tidytacos object.

- [`add_alpha()`](https://lebeerlab.github.io/tidytacos/reference/add_alpha.md)
  : Add alpha diversity measure
- [`add_alphas()`](https://lebeerlab.github.io/tidytacos/reference/add_alphas.md)
  : Add alpha diversity measures
- [`add_subsampled_alpha()`](https://lebeerlab.github.io/tidytacos/reference/add_subsampled_alpha.md)
  : Add alpha diversity measures using subsampling
- [`betas()`](https://lebeerlab.github.io/tidytacos/reference/betas.md)
  : Get beta diversity table
- [`add_ord()`](https://lebeerlab.github.io/tidytacos/reference/add_ord.md)
  : Add ordination
- [`add_copca()`](https://lebeerlab.github.io/tidytacos/reference/add_copca.md)
  : Add compositional principal components to the sample table
- [`add_tree()`](https://lebeerlab.github.io/tidytacos/reference/add_tree.md)
  : Construct a phylogeny from ASV sequences
- [`calculate_unifrac_distances()`](https://lebeerlab.github.io/tidytacos/reference/calculate_unifrac_distances.md)
  : Calculate unifrac distance matrix from a tidytacos object with a
  rooted tree

## Clustering

Functions to cluster the sample and taxa table.

- [`cluster_samples()`](https://lebeerlab.github.io/tidytacos/reference/cluster_samples.md)
  : Clusters samples into n clusters
- [`perform_lda()`](https://lebeerlab.github.io/tidytacos/reference/perform_lda.md)
  : LDA model estimation
- [`cluster_taxa()`](https://lebeerlab.github.io/tidytacos/reference/cluster_taxa.md)
  : Performs SparCC network analysis on a tidytacos object and then
  performs Markov Clustering on the network to annotate taxa of the
  largest clusters in the tidytacos object.
- [`add_sample_clustered()`](https://lebeerlab.github.io/tidytacos/reference/add_sample_clustered.md)
  : Add clustering-based sample order

## Network analysis

Functions to perform network inference, clustering and filtering the
resulting clusters.

- [`network()`](https://lebeerlab.github.io/tidytacos/reference/network.md)
  :

  Perform network inference with SparCC on a tidytacos object, after
  dropping rare taxa. See
  [`SpiecEasi::sparcc()`](https://rdrr.io/pkg/SpiecEasi/man/sparcc.html).

- [`filter_network()`](https://lebeerlab.github.io/tidytacos/reference/filter_network.md)
  :

  Filters the output of
  [`network()`](https://lebeerlab.github.io/tidytacos/reference/network.md)
  to a minimal threshold and transforms to matrix for downstream
  clustering or heatplot visualization.

- [`cluster_network()`](https://lebeerlab.github.io/tidytacos/reference/cluster_network.md)
  :

  Performs Markov Clustering on a sparcc network matrix generated by
  [`filter_network()`](https://lebeerlab.github.io/tidytacos/reference/filter_network.md).
  and returns a tibble with clusters and taxon identifiers. Optionally,
  the network can be visualized.

## Topic Modeling (LDA)

Methods to help with topic modeling of microbiome data using Latent
Dirichlet Allocation.

- [`perform_lda()`](https://lebeerlab.github.io/tidytacos/reference/perform_lda.md)
  : LDA model estimation
- [`ldaplot_beta()`](https://lebeerlab.github.io/tidytacos/reference/ldaplot_beta.md)
  : Plot LDA beta values
- [`calculate_lda_perplexities()`](https://lebeerlab.github.io/tidytacos/reference/calculate_lda_perplexities.md)
  : Calculate LDA model perplexities for a range of topic numbers
- [`align_lda_topics()`](https://lebeerlab.github.io/tidytacos/reference/align_lda_topics.md)
  : Aligns LDA topics across models
- [`ldaplot_alignment()`](https://lebeerlab.github.io/tidytacos/reference/ldaplot_alignment.md)
  : Plot LDA topic alignment results

## Datasets

Test datasets used as examples.

- [`urt`](https://lebeerlab.github.io/tidytacos/reference/urt.md) :
  Upper Respiratory Tract samples
- [`leaf`](https://lebeerlab.github.io/tidytacos/reference/leaf.md) :
  Phylosphere samples

## Miscellaneous

Functions to tidy up the three tables or convert to other data
structures.

- [`trim_asvs()`](https://lebeerlab.github.io/tidytacos/reference/trim_asvs.md)
  : Trim all sequences
- [`classify_taxa()`](https://lebeerlab.github.io/tidytacos/reference/classify_taxa.md)
  : (Re)classify amplicon sequences
- [`reset_ids()`](https://lebeerlab.github.io/tidytacos/reference/reset_ids.md)
  : Reset the taxon and sample IDs
- [`change_id_samples()`](https://lebeerlab.github.io/tidytacos/reference/change_id_samples.md)
  : Change sample IDs to a given expression
- [`change_id_taxa()`](https://lebeerlab.github.io/tidytacos/reference/change_id_taxa.md)
  : Change taxon IDs to a given expression
- [`remove_empty_samples()`](https://lebeerlab.github.io/tidytacos/reference/remove_empty_samples.md)
  : Removes empty samples from the tidytacos object
- [`remove_duplicate_samples()`](https://lebeerlab.github.io/tidytacos/reference/remove_duplicate_samples.md)
  : Removes duplicate samples from the tidytacos object
- [`tidy_count_to_matrix()`](https://lebeerlab.github.io/tidytacos/reference/tidy_count_to_matrix.md)
  : Convert counts tidy data frame to matrix
- [`rarefy()`](https://lebeerlab.github.io/tidytacos/reference/rarefy.md)
  : Rarefy the samples to a given number of reads
- [`test_taco()`](https://lebeerlab.github.io/tidytacos/reference/test_taco.md)
  : Create a tidytacos object for testing/example purporses
- [`taxonlist_per_condition()`](https://lebeerlab.github.io/tidytacos/reference/taxonlist_per_condition.md)
  : Return a list of taxon IDs per condition
- [`tacosum()`](https://lebeerlab.github.io/tidytacos/reference/tacosum.md)
  : Return some descriptive numbers

# Articles

### Tutorials

- [Tidytacos quick start
  guide](https://lebeerlab.github.io/tidytacos/articles/getting-started.md):
- [Stacked
  Barplots](https://lebeerlab.github.io/tidytacos/articles/stacked-barplot.md):
- [Network
  Analysis](https://lebeerlab.github.io/tidytacos/articles/network-analysis.md):
- [Taxa and sample quality
  control](https://lebeerlab.github.io/tidytacos/articles/data-processing.md):
